<!DOCTYPE html>
<html lang="english" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>

    <title>Is today recyling? Using Python and Telegram to Remind You - Martin Noah</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link href="https://martinnoah.com/images/favicon.png" rel="icon">

<link rel="canonical" href="https://martinnoah.com/this-post-is-garbage.html">

        <meta name="author" content="Martin Noah" />
        <meta name="keywords" content="python,pythonanywhere,telegram" />
        <meta name="description" content="Is Today Recyling? Every Wednesday is Garbage day. Every two weeks is Garbage and Recyling day, but I can never remember and usually end up having to checkout the calendar. Soooo inconvenient, right?! Enter Python, Telegram, and PythonAnywhere, an incredible source for developing and programming with Python. It offers full-blown …" />

        <meta property="og:site_name" content="Martin Noah" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Is today recyling? Using Python and Telegram to Remind You"/>
        <meta property="og:url" content="https://martinnoah.com/this-post-is-garbage.html"/>
        <meta property="og:description" content="Is Today Recyling? Every Wednesday is Garbage day. Every two weeks is Garbage and Recyling day, but I can never remember and usually end up having to checkout the calendar. Soooo inconvenient, right?! Enter Python, Telegram, and PythonAnywhere, an incredible source for developing and programming with Python. It offers full-blown …"/>
        <meta property="article:published_time" content="2018-07-19" />
            <meta property="article:section" content="Blog" />
            <meta property="article:tag" content="python" />
            <meta property="article:tag" content="pythonanywhere" />
            <meta property="article:tag" content="telegram" />
            <meta property="article:author" content="Martin Noah" />
            <meta property="og:image"
                  content="https://martinnoah.com/images/FuEA2MYH_400x400.jpg"/>

    <meta name="twitter:dnt" content="on">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:domain" content="https://martinnoah.com">
            <meta property="twitter:image"
                  content="https://martinnoah.com/images/FuEA2MYH_400x400.jpg"/>


    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://martinnoah.com/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="https://martinnoah.com/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://martinnoah.com/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="https://martinnoah.com/theme/css/style.css" type="text/css"/>







</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://martinnoah.com/" class="navbar-brand">
<img class="img-responsive pull-left gap-right" src="https://martinnoah.com/images/favicon.png" width="32"/> Martin Noah            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="https://martinnoah.com/pages/about.html">
                             About
                          </a></li>
                         <li><a href="https://martinnoah.com/pages/contact.html">
                             Contact
                          </a></li>
                        <li class="active">
                            <a href="https://martinnoah.com/category/blog.html">Blog</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<!-- Banner -->
<!-- End Banner -->

<!-- Content Container -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://martinnoah.com/this-post-is-garbage.html"
                       rel="bookmark"
                       title="Permalink to Is today recyling? Using Python and Telegram to Remind You">
                        Is today recyling?  Using Python and Telegram to Remind You
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2018-07-19T00:00:00-04:00"> Thu 19 July 2018</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="https://martinnoah.com/tag/python.html">python</a>
        /
	<a href="https://martinnoah.com/tag/pythonanywhere.html">pythonanywhere</a>
        /
	<a href="https://martinnoah.com/tag/telegram.html">telegram</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <h2>Is Today Recyling?</h2>
<p>Every Wednesday is Garbage day.  Every two weeks is Garbage <strong>and</strong> Recyling day, but I can never remember and usually end up having to checkout the calendar.  Soooo inconvenient, right?!  Enter Python, Telegram, and PythonAnywhere, an incredible source for developing and programming with Python.  It offers full-blown Python environments and website hosting with your own subdomain, and a helpful blog and forum if you're just getting started.  One of it's cool features and the subject of this post are scheduled tasks, in which you can write a script to execute at a set time every day.  What we want to accomplish is this: a Telegram bot to text me every Wednesday morning, indicating if it's a recycling and garbage day, or just garbage.  With the time this has saved me from having to manually check calendars, I'm able to share it with the world!</p>
<h2>Are you ready?</h2>
<p>We'll need the following:</p>
<ol>
<li>Pythonanywhere.com account - a free account will work.</li>
<li>The Telegram app installed on your phone.</li>
<li>Pictures of garbage/recycling (optional).</li>
</ol>
<h2>Telegram</h2>
<p>Download the telegram app on your smartphone and start a chat with the @BotFather.  Create a new bot with the /newbot command, and the BotFather will chat with you for the details.  He'll ask you for a general name for your bot and then a unique username. Once finished you'll be given an HTTP API token&mdash;keep that handy as we'll need it later.  </p>
<p><img style="max-width: 400px;width:100%; height:    auto;" src='/images/fatherbot.png'></p>
<p>Back in the main chat menu of Telegram, create a new group.  Tap the search bar, and search for the username of your bot.  What you'll end up with is a "group" chat, but it's only yourself and your bot.  Now we need one additional credential before we can jump into the Python script, and it's the group chat ID. To get the ID, go to https://web.telegram.org and follow the steps to get into your account.  Once in, click the group chat you created.  In the address bar, you'll see a parameter that begins with the letter 'g'.  Take note of this ID.  If you get stuck obtaining the chat ID, <a href="https://stackoverflow.com/questions/32423837/telegram-bot-how-to-get-a-group-chat-id#answer-50661601">see this SO question and answers:</a></p>
<p><img style="max-width: 400px;width:100%; height:    auto;" src='/images/chat_id.png'></p>
<h2>The script</h2>
<p>First, you'll most likely need to install the Python Telegram library: <code>pip install python-telegram-bot</code> </p>
<p>Let's start by writing the Python script, <strong>garbage.py</strong></p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">telegram</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>

<span class="n">bot</span> <span class="o">=</span> <span class="n">telegram</span><span class="o">.</span><span class="n">Bot</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="s1">&#39;YOUR_UNIQUE_TOKEN&#39;</span><span class="p">)</span>
</pre></div>


<p>Import the necessary libraries and create our bot.  Remember to grab your own token that @BotFather gave you.</p>
<div class="highlight"><pre><span></span>recycling_days = [
                &#39;2018-01-10&#39;, &#39;2018-01-24&#39;, &#39;2018-02-07&#39;,
                &#39;2018-02-21&#39;, &#39;2018-03-07&#39;, &#39;2018-03-21&#39;,
                &#39;2018-04-07&#39;, &#39;2018-04-18&#39;, &#39;2018-05-02&#39;,
                &#39;2018-05-16&#39;, &#39;2018-05-30&#39;, &#39;2018-06-13&#39;,
                &#39;2018-06-27&#39;, &#39;2018-07-11&#39;, &#39;2018-07-25&#39;,
                &#39;2018-08-08&#39;, &#39;2018-08-22&#39;, &#39;2018-09-05&#39;,
                &#39;2018-09-19&#39;, &#39;2018-10-03&#39;, &#39;2018-10-17&#39;,
                &#39;2018-10-31&#39;, &#39;2018-11-14&#39;, &#39;2018-11-28&#39;,
                &#39;2018-12-12&#39;, &#39;2018-12-26&#39;]
</pre></div>


<p>Create a simple list of strings of the recyling days.</p>
<div class="highlight"><pre><span></span>today = date.today()
</pre></div>


<p>Assign today's date to the variable <code>today</code></p>
<div class="highlight"><pre><span></span>if today.weekday() == 2:
    if str(today) in recycling_days:
        bot.send_photo(chat_id=-&lt;YOUR_CHAT_ID&gt;, photo=open(&#39;garbage_recycling.jpg&#39;, &#39;rb&#39;))
        bot.send_message(chat_id=-&lt;YOUR_CHAT_ID&gt;, text=&quot;Recycling!&quot;)
    else:
        bot.send_photo(chat_id=-&lt;YOUR_CHAT_ID&gt;, photo=open(&#39;garbage.jpeg&#39;, &#39;rb&#39;))
        bot.send_message(chat_id=-&lt;YOUR_CHAT_ID&gt;, text=&quot;Today is just a garbage day.&quot;)
</pre></div>


<p><strong>Note the '-' before your chat id</strong> so an example would be <code>chat_id=-9999233</code></p>
<p>Pythonanywhere's scheduled task feature will run every single day at the time you tell it to run.  For free accounts, you cannot specifiy what day you want it to run, or at what hour.  So we have to decide in our code what day of the week it is, since Garbage/Recycling days are only on Wednesdays (and we don't want to get a Telegram message every day).  We just evaluate if <code>today.weekday() == 2</code> where Monday is the first day of the week starting at 0, Tuesday = 1, and so on.</p>
<p>The rest of the code checks to see if todays date (converted to a string) is in our list of <code>recycling_days</code>.  If it is, we send a photo of recycling cans and a message "Recyling!"  Otherwise, we send a garbage only image and message.</p>
<p><img style="max-width: 400px;width:100%; height:    auto;" src='/images/telegramGarbage.png'></p>
<h2>Pythonanywhere</h2>
<p>Once you log into your account, navigate to the <strong>Files</strong> tab and upload our script, <strong>garbage.py</strong>, and the images.  Then go to the <strong>Consoles</strong> tab and under "Start a new console:" select <strong>Bash</strong>.</p>
<p>Once the terminal fires up, you'll need to install the Telegram python package.</p>
<p>In the console, type:
<code>pip3.6 install --user python-telegram-bot</code></p>
<p>And, since the default Python version in Pythonanywhere is 2.7, you'll need to add a shebang on the first line of <strong>garbage.py</strong> so that Python 3.6 is used to run the script.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/env python3.6</span>
<span class="kn">import</span> <span class="nn">telegram</span>

<span class="c1"># The rest of the code...</span>
</pre></div>
</td></tr></table>

<h3>Tasks</h3>
<p>Finally, navigate to the <strong>Tasks</strong> tab of our Pythonanywhere account.  Under scheduled tasks, set the UTC time for when you want the script to execute.  I set mine for 10:00 which is 6:00AM NYC time and right around the time I start contemplating my recycling confusion. </p>
<p>In the command text box, enter <code>python 3.6 /home/YOUR_USERNAME/garbage.py</code> and create the task.</p>
            </div>
            <!-- /.entry-content -->
    <hr />
    <!-- AddThis Button BEGIN -->
    <div class="addthis_toolbox addthis_default_style">
            <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
            <a class="addthis_button_tweet"></a>
            <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    </div>
    <!-- AddThis Button END -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'martinnoah'; // required: replace example with your forum shortname

                    var disqus_identifier = 'this-post-is-garbage';
                var disqus_url = 'https://martinnoah.com/this-post-is-garbage.html';

            var disqus_config = function () {
                this.language = "english";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
                
<!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Social -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
  <ul class="list-group" id="social">
    <li class="list-group-item"><a href="https://twitter.com/MixMasterMartin"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
    <li class="list-group-item"><a href="https://www.facebook.com/martin.noah.98"><i class="fa fa-facebook-square fa-lg"></i> Facebook</a></li>
  </ul>
</li>
<!-- End Sidebar/Social -->
  </ul>
</section>
<!-- End Sidebar --><div id="aboutme">
    <p>
      <strong>About Martin Noah</strong><br/>
        Random tutorials and blog posts about Python, Excel, Web Development, and maybe some hockey (Go Pens!)
    </p>
</div>            </aside>
        </div>
    </div>
</div>
<!-- End Content Container -->

<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2018 Martin Noah
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://martinnoah.com/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://martinnoah.com/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://martinnoah.com/theme/js/respond.min.js"></script>


    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'martinnoah'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-118771828-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->


        <script type="text/javascript">var addthis_config = {"data_track_addressbar": true};</script>
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5b01709f0c3abefa"></script>
</body>
</html>